# [DATABASE] 정규화 (Normalization)

:writing_hand: *Assembled by JiYoung-Kwon (2021-01-31)* 



## 1. DATABASE 정규화

* 데이터의 일관성, 최소한의 데이터 중복, 최대한의 데이터 유연성을 위한 방법이며 데이터를 분해하는 과정
* **이상 문제**를 해결하기 위해 속성들끼리의 종속 관계를 분석하여 여러 개의 릴레이션으로 **분해**하는 과정
  * 일반적으로 테이블을 여러 개로 분해하면 속도는 상대적으로 느려질 수 있지만, 분해하지 않으면 이상 문제들이 발생함

#### 1-1. 이상 문제 (Anomaly)

- 삽입 이상

  - 데이터를 저장할 때 원하지 않는 정보가 함께 삽입되는 경우

- 삭제 이상

  - 튜플을 삭제함으로써 유지되어야 하는 정보 까지도 연쇄적으로 삭제되는 경우

- 갱신 이상

  - 중복된 튜플 중 일부의 속성만 갱신 시킴으로써 정보의 모순성이 발생하는 경우

- 예시

  ![img](https://blog.kakaocdn.net/dn/IVop1/btqBLknJv4R/VZKQNAvvJl4iSSbTezBobK/img.png)

  - 삽입 이상 
    - 신입 학생이 입학하여 학번과 학년 등을 입력하려 하는 경우
      - 아직 과목이 정해지지 않았거나, 시험을 보지 않아 성적이 없는 상태이기 때문에 **불필요한 정보**(과목 이름, 성적)를 **함께 삽입**해야 함
  - 삭제 이상
    - 학생 번호가 2번인 학생의 과목에 대한 성적을 삭제할 경우
      - 학생 번호와 학년 등 **모든 정보가 같이 삭제**되어 학생의 정보 자체가 사라짐
  - 갱신 이상
    - 학생 번호가 3번인 학생이 2학년이 되어 학년 정보를 변경하려 하는 경우
      - 3개를 모두 하나씩 바꿔줘야 함
      - 하나라도 안바꿀 경우 한 명의 학생에 대한 정보가 서로 달라지는 **정보의 모순성**이 발생

#### 1-2. 함수적 종속

* 어떠한 릴레이션에서 속성들의 부분 집합을 X, Y라 할 때
  * 특정 튜플에서 X의 값이 Y의 값을 함수적으로 결정한다면 'Y가 X에 함수적으로 종속'되었다고 함

* 함수적 종속의 추론 규칙
  * 재귀 규칙 : Y가 X의 부분 집합이면 X → Y 이다.
  * 증가 규칙 : X → Y 이면 WX → WY 이고 WX → Y 이다.
  * 이행 규칙 : X → Y 이고 Y → Z 이면 X → Z 이다.
  * 유니온 규칙 : X → Y 이고 X → Z 이면 X → YZ 이다.
  * 분해 규칙 : X → YZ 이면 X → Y와 X → Z 이다.
  * 가이행 규칙 : 만일 W → X 이고 XY → Z 이면 WY → Z 이다.

<br/>

## 2. 정규화의 목적

* 불필요한 데이터를 제거하여 중복을 최소화함
  * 정보의 일관성을 보장하기 위함
* 삽입/갱신/삭제 시 발생할 수 있는 각종 이상 현상을 방지하기 위해
* 데이터의 모형을 단순화시키기 위함
* 데이터 구조의 안정성 및 무결성을 유지하기 위함
* 속성의 배열 상태 검증
* 엔터티와 속성의 누락 여부 검증 수단
* 자료 검색과 추출의 효율성을 추구



## 3. 정규화 과정

* 정규화는 1정규화 ~ 6정규화 까지 여러 과정이 존재하지만, 실무에서는 대체로 1~3 정규화까지의 과정을 거치게 됨

<br/>

#### 제1 정규형

* 도메인은 모두 원자값이어야 함

* 예시  - 정규화 수행 전

  ![img](https://blog.kakaocdn.net/dn/bIXuX0/btqBGpEhISu/kNCOwnGlgcOJLMP43tiV6k/img.png)

  * 핸드폰 번호에 2가지가 들어가있어 제1 정규형을 만족하지 않음
* 예시 - 정규화 수행 후

  ![img](https://blog.kakaocdn.net/dn/cDtHsC/btqBLiXLMaA/e1iuGoGl5Eppp0CP5PAzEk/img.png)

* 관계형 데이터베이스의 경우
  
  * 기본적으로 도메인은 모두 원자값이라 제1 정규형이 지켜져 있음

<br/>

#### 제2 정규형

- 부분 함수 종속성을 제거함

  - 부분 함수적 종속
    - 릴레이션에서 종속자가 기본키가 아닌 다른 속성에 종속되는 경우
    - 기본키가 여러 속성으로 구성되어 있을 경우, 기본키를 구성하는 속성 중 일부만 종속되는 경우

- 예시 - 정규화 수행 전

  ![img](https://blog.kakaocdn.net/dn/cmTwvD/btqBHTxUlyE/Wad2A4jpY6pEXfarlh1v91/img.png)

  * 학번은 학부와 등록금을 결정할 수 있고, 학번과 과목 코드는 성적을 결정할 수 있다.

  * 부분 함수인 학번 혼자서 학부와 등록금을 결정할 수 있다. 

  * 제2 정규형을 만족할 수 없음

* 예시 - 정규화 수행 후

  ![img](https://blog.kakaocdn.net/dn/eNjmkB/btqBGfor6SV/7OcKkFE73Xiw0T9Ylc1nu1/img.png)

  * 성적, 학부, 등록금에 모두 영향을 주는 학번을 기준으로 릴레이션을 분리시킴

<br/>

#### 제3 정규형

- 이행 함수 종속을 제거함

- 예시 - 정규화 수행 전

  ![img](https://blog.kakaocdn.net/dn/eNjmkB/btqBGfor6SV/7OcKkFE73Xiw0T9Ylc1nu1/img.png)	

  * 학번(X)이 학부(Y)를 결정, 학부(Y)가 등록금(Z)을 결정

  * 이행 규칙에 따라 학번(X)가 등록금(Z)을 결정할 수 있음
    * **이행 규칙** : X -> Y 이고 Y -> Z 이면 X -> Z이다.

  * 이행 규칙을 만족하므로 제3 정규형을 만족 시키지 못함

* 예시 - 정규화 수행 후

  ![img](https://blog.kakaocdn.net/dn/SlASz/btqBHTdDoo3/6yv3htZo6k1twifKSUd9MK/img.png)

  * 갱신 이상이나 여러 문제가 발생할 수 있기 때문에, X -> Y, Y -> Z 의 형태로 릴레이션을 다시 분해함

<br/>

#### BCNF 정규화

- 3차 정규형을 조금 더 강화한 버전으로 볼 수 있음

  - 3차 정규형으로 해결할 수 없는 이상 현상을 해결함

- 모든 결정자가 후보키 집합에 속한 정규형임

- 예시 - 정규화 수행 전

  | 학생* | 과목* | 교수   | 학점 |
  | ----- | ----- | ------ | ---- |
  | 1     | AB123 | 김인영 | A    |
  | 2     | CS123 | Mr.Sim | A    |
  | 3     | CS123 | Mr.Sim | A    |

  - 후보키인 학생, 과목으로 그 로우를 유일하게 구분할 수 있음
  - 이 테이블의 경우 교수가 결정자임 (교수가 한 과목만 강의할 수 있다고 가정)
    - 즉, 교수가 정해지면 과목이 결정됨
  - 교수는 후보키가 아니기 때문에 이 경우 BCNF를 만족하지 못함
  - 위와 같이 테이블이 구성되면, 데이터가 중복되고 갱신 이상을 발생시킴
  - Mr.Sim이 강의하는 과목명이 바뀌면 두 개의 로우를 모두 갱신해야 함
  - 이 문제를 해결하기 위해 테이블을 분리함

- 예시 - 정규화 수행 후

  * 교수 테이블

  | 교수   | 과목  |
  | ------ | ----- |
  | 김인영 | AB123 |
  | Mr.Sim | CS123 |

  * 수강 테이블

  | 학생 | 과목  | 학점 |
  | ---- | ----- | ---- |
  | 1    | AB123 | A    |
  | 2    | CS123 | A    |
  | 3    | CS123 | A    |

<br/>

#### 제4 정규화

- 데이터베이스의 이상 현상의 원인이 되는 데이터 중복성을 제거하여 무결성을 보존하는 것

- 다치 종속성을 제거하고, 특성 속성값에 따라 선택적인 속성을 분리하는 과정

- 예시 - 정규화 수행 전

  | 개발자 | 자격증             | 언어 |
  | ------ | ------------------ | ---- |
  | 홍길동 | 정보처리기사       | C    |
  | 홍길동 | 빅데이터 분석 기사 | C++  |
  | 장길산 | 정보처리기사       | JAVA |

  - 개발자 마다 자격증 값이 존재하고,
    - 특정 개발자 마다 언어 값들이 여러개 존재하는 경우 다치 종속 관계라고 한다.
  - <개발자, 자격증>과 <개발자, 언어> 테이블로 분리하여 관리하면 다치 종속 관계를 제거할 수 있다.

- 예시 - 정규화 수행 후

  | 개발자 | 자격증             |
  | ------ | ------------------ |
  | 홍길동 | 정보처리기사       |
  | 홍길동 | 빅데이터 분석 기사 |
  | 장길산 | 정보처리기사       |

  | 개발자 | 언어 |
  | ------ | ---- |
  | 홍길동 | C    |
  | 홍길동 | C++  |
  | 장길산 | JAVA |

<br/>

#### 제5 정규화

- 릴레이션에 존재하는 **조인 종속**의 후보키를 통해서만 성립이 되도록하는 정규형

  > * 조인 종속 : 원래의 릴레이션을 분해한 뒤 자연 조인한 결과가 원래의 릴레이션과 같은 결과가 나오는 종속성

- 예시 - 정규화 수행 전

  | 사원   | 기술       | 언어     |
  | ------ | ---------- | -------- |
  | 홍길동 | 모델링     | 영어     |
  | 홍길동 | 파워포인트 | 중국어   |
  | 홍길동 | 모델링     | 프랑스어 |
  | 김길동 | 파워포인트 | 일어     |

  - 사원이 보유한 기술과 구사하는 언어가 관계가 있다는 업무 요건이 존재할 경우, 세 속성 사이에 연관성이 존재하며, 조인 종속이 존재하기 때문에 제5 정규화 대상이다.

- 예시 - 정규화 수행 후

  | 사원   | 기술       |
  | ------ | ---------- |
  | 홍길동 | 모델링     |
  | 홍길동 | 파워포인트 |
  | 김길동 | 파워포인트 |

  | 기술       | 언어     |
  | ---------- | -------- |
  | 모델링     | 영어     |
  | 파워포인트 | 중국어   |
  | 모델링     | 프랑스어 |
  | 파워포인트 | 일어     |

  | 사원   | 언어     |
  | ------ | -------- |
  | 홍길동 | 영어     |
  | 홍길동 | 중국어   |
  | 홍길동 | 프랑스어 |
  | 김길동 | 일어     |

<br/>


## :bulb: 예상질문

Q1 - 정규화가 무엇인가요?

A1 - 이상 문제를 해결하기 위해 속성들끼리의 종속 관계를 분석하여 여러 개의 릴레이션으로 분해하는 과정입니다. 데이터의 일관성, 최소한의 데이터 중복, 최대한의 데이터 유연성을 위한 방법입니다.

<br/>

Q2 - 정규화가 왜 필요한가요?

A2 - 각종 이상 현상을 방지하기 위해서입니다. 불필요한 데이터를 제거하여 중복을 최소화하고, 정보의 일관성을 보장할 수 있습니다.

<br/>

## :page_with_curl: Reference

[[DB 이론] 데이터베이스 정규화란? (이상 문제, 함수적 종속, 정규화 과정)](https://nirsa.tistory.com/107)

[데이터베이스 정규화(Normalization)란?](https://velog.io/@wldus9503/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%95%EA%B7%9C%ED%99%94Normalization%EB%9E%80)

[데이터베이스 정규화 1NF, 2NF, 3NF, BCNF](https://3months.tistory.com/193)

[정규화 : 제 4 정규형(4NF)](https://geol2.tistory.com/203)

[제5정규형(5NF)](https://m.blog.naver.com/PostView.nhn?blogId=zzoyou_&logNo=221331389064&proxyReferer=https:%2F%2Fwww.google.com%2F)

[정규화(Normalization)-정의, 목적, 특징, 유형, 정규화 수준에 따른 장단점](https://codedragon.tistory.com/5496)