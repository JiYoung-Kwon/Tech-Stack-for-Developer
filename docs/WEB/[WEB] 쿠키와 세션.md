# [WEB] 쿠키와 세션

:writing_hand: *Assembled by JiYoung-Kwon (2021-01-05)* 



#### :pushpin: 쿠키와 세션을 사용하는 이유

* HTTP 프로토콜의 특징이자 약점을 보완하기 위해

***



## 1. HTTP*(Hypertext Transfer Protocol)*의 특징

#### 1-1. Connectionless (비연결지향)

* 클라이언트에서 서버에 요청을 보내면 서버는 클라이언트에 응답을 하고 `연결(Connection)을 끊는 특성`이 있음
  * HTTP1.1 - Connection 헤더에 keep-alive 옵션 : 커넥션 유지 가능

#### 1-2. Stateless (상태 없음)

* Connection을 끊는 순간 클라이언트 - 서버의 통신이 끝나며, `상태 정보는 유지하지 않는 특성`

#### 1-3. 장-단점

* 장점

  > * 계속해서 커넥션을 유지하지 않기 때문에 서버 리소스 낭비가 줄어듬

* 단점 

  > * 통신할 때마다 새로 커넥션을 만들기 때문에 클라이언트 측면에서는 상태를 유지를 위해 통신할 때마다 어떤 절차를 가져야함
  >
  > * 사용자를 식별할 수 없어서 같은 사용자가 요청을 여러번 하더라도 매번 새로운 사용자로 인식하는 단점

HTTP의 비연결성과 비상태성을 보완하여 서버가 클라이언트를 식별하게 해주는 것이 쿠키와 세션



## 2. 쿠키(Cookie)란?

* 클라이언트 로컬(local)에 저장되는 **Key-Value**쌍의 작은 데이터 파일

#### 2-1. 구성요소

* 이름, 값, 만료 날짜/시간(쿠키 저장기간), 경로 정보, 보안연결여부 등...

#### 2-2. 동작방식

<img src="https://miro.medium.com/max/1325/1*fWfKsO9P2rReNzJM2doBhQ.png" alt="Image for post" style="zoom:50%;" />

> 1. 클라이언트가 서버에 로그인 요청
> 2. 서버는 로그인 요청의 유효성을 확인하고(아이디와 비밀번호 검사) `응답헤더`에 `set-cookie` 속성을 이용하여 클라이언트에 쿠키를 제공
> 3. 클라이언트는 이후 서버에 요청할 때 전달받은 쿠키를 자동으로 `요청헤더`에 추가하여 요청 

* 쿠키는 클라이언트의 상태 정보를 로컬에 저장했다가 요청(Request)할 때 참조됨

* 쿠키는 서버측에서 만료 날짜/시간을 지정하여 정해진 시간동안 데이터(상태정보)를 유지할 수 있음 (로그인 상태 유지에 활용됨)

* 사용 예

  * 아이디, 비밀번호 저장
  * 쇼핑몰 장바구니

  

## 3. 세션(Session)이란?

* 서버(Server)에 클라이언트의 상태 정보를 저장하는 기술로 **논리적인 연결**
* 웹 서버에 클라이언트에 대한 정보를 저장하고, 클라이언트에게는 클라이언트를 구분할 수 있는 ID를 부여 : **Session ID**

#### 3-1. 동작방식

<img src="https://miro.medium.com/max/1403/1*oiHghHg3sQW5ynmMCAtPAA.png" alt="Image for post" style="zoom:50%;" />

> 1. 클라이언트가 서버에 로그인 요청
> 2. 서버는 로그인 요청의 유효성을 확인하고(아이디와 비밀번호 검사) 클라이언트에 유일한 ID(Session ID)를 부여
> 3. 서버가 응답할 때 HTTP 헤더(Set-Cookie)에 Session ID를 포함해 전송
> 4. 클라이언트는 이후 요청 시 전달받은 Session ID가 담겨있는 쿠키를 HTTP 헤더에 넣어서 전송
> 5. 서버는 Session ID를 확인하고, 해당 세션에 관련된 정보를 확인한 후 응답

* 세션을 통해 클라이언트의 정보는 서버에 두고, 세션 아이디를 이용해서 인증받고 정보를 이용하는 방식

* 사용 예
  * 로그인 정보 유지



## 4. 쿠키 VS 세션

|          | Cookie                                                       | Session       |
| -------- | ------------------------------------------------------------ | ------------- |
| 저장위치 | Client                                                       | Server        |
| 저장형식 | text                                                         | Object        |
| 리소스   | 클라이언트의 리소스                                          | 서버의 리소스 |
| 용량제한 | 도메인 당 20개, 1쿠키 당 4KB                                 | 제한 없음     |
| 만료시점 | 쿠키 저장 시 설정<br />(설정 없을 시에는 브라우저 종료시 만료) | 알 수 없음    |

* 저장위치
  * 쿠키 : 클라이언트(웹 브라우저)가 지저아는 메모리 또는 파일에 저장(local)
  * 세션 : 서버 메모리에 저장
* 저장형식
  * 쿠키 : text 형식
  * 세션 : Object 형식
* 리소스(사용되는 자원)
  * 쿠키 : 클라이언트에 저장, 클라이언트의 메모리를 사용. 서버의 자원을 사용하지 않음
  * 세션 : 서버에 저장, 서버의 메모리로 로딩. 세션이 생길 때마다 서버의 리소스를 차지
* 용량제한
  * 쿠키 : 한 도메인 당 20개, 1쿠키 당 4KB로 제한 (클라이언트도 모르게 접속되는 사이트에 의해 설정될 수 있기 때문에 문제가 발생하는 것을 막고자)
  * 세션 : 갯수나 용량에 제한 없음
* Life Cycle
  * 쿠키 : 저장 시, expires 속성을 정의해 무효화 시키면 삭제될 날짜를 지정할 수 있음 (따로 지정되지 않은 경우에는 브라우저 종료 시 만료)
  * 세션 : 브라우저 종료 시 세션 삭제. 클라이언트가 로그아웃하거나, 설정한 시간동안 반응이 없을 경우 무효화 되기 때문에 정확한 시점을 알 수 없음
* 보안
  * 쿠키 : 클라이언트 로컬에 저장. 탈취 및 변조 위험 있음
  * 세션 : 클라이언트 정보 자체는 서버에 저장. 비교적 안전함
* 속도
  * 쿠키 : 서버에 요청 시, 헤더를 바로 참조하면 되므로 상대적으로 빠름
  * 세션 : 요청마다 세션아이디를 이용해 서버에서 처리 비교해야하므로 비교적 느림



## 5. 간단요약​

![img](https://blog.kakaocdn.net/dn/c1UC0j/btqBJ7qtIpt/k1b6Pw2heFR9fbesfWeY01/img.png)

## :page_with_curl: Reference

[[WEB] 쿠키,세션이란?](https://chrisjune-13837.medium.com/web-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98%EC%9D%B4%EB%9E%80-aa6bcb327582)

[Web - 쿠키와 세션의 차이, 용도, 사용법(cookie,session)](https://jeong-pro.tistory.com/80)

[[web] 쿠키(cookie)와 세션(session)의 개념/차이/용도/작동방식](https://devuna.tistory.com/23)

